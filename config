# -*- mode: sh -*-

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

. "$DIR/global_functions"

# TODO put section in README about this when installing
[ ! -e "$DIR/personal_config" ] && die "Please create the \`personal_config\` file"

. "$DIR/personal_config"

personal_config_errors=false

# TODO need to cut down the repeated messages
isset "$NGGROUP_SERVER_NAME" 'Constant $NGGROUP_SERVER_NAME not set in \`personal_config\`' || personal_config_errors=true
isset "$NGGROUP_SERVER_ROOT_URL" 'Constant $NGGROUP_ROOT_URL not set in \`personal_config\`' || personal_config_errors=true
isset "$NGGROUP_SERVER_ADMIN_EMAIL" 'Constant $NGGROUP_SERVER_ADMIN_EMAIL not set in \`personal_config\`' || personal_config_errors=true

if $personal_config_errors;
then
	die "Please fix the above errors before continuing"
fi

# if we're not in production, use the current directory
if [ -n "$_IN_PRODUCTION" ]; 
then
	HTPASS_DIR=/etc/nginx/htpasswd
else
	HTPASS_DIR=.
fi

# our standard config
SITES_DIR=$HTPASS_DIR/sites
SITES_DIR_FORMAT="$SITES_DIR/.%s.rules"
SITES_COMPLETE_DIR_FORMAT="$SITES_DIR/%s"

USER_DIR=$HTPASS_DIR/users
USER_DIR_FORMAT="$USER_DIR/.%s.rules"
USER_COMPLETE_DIR_FORMAT="$USER_DIR/%s"
USER_RULE_FORMAT="%s"


GROUP_DIR=$HTPASS_DIR/groups
GROUP_DIR_FORMAT="$GROUP_DIR/%s"
GROUP_RULE_FORMAT="@%s"
TMP_FILE=/tmp/nggrouptmp
